# Redis-AKF/CAP原理


# Redis-AKF/CAP原则

## 1. AKF 扩展立方体理论

之前讨论的情况都是**单机版单进程**下的情况

> **AKF扩展立方体（Scalability Cube）**，是《架构即未来》一书中提出的可扩展模型，这个立方体有三个轴线，每个轴线描述扩展性的一个维度，他们分别是产品、流程和团队：
>
> X轴 —— 代表无差别的克隆服务和数据，工作可以很均匀的分散在不同的服务实例上；
>
> Y轴 —— 关注应用中职责的划分，比如数据类型，交易执行类型的划分；
>
> Z轴 —— 关注服务和数据的优先级划分，如分地域划分。
>
> 
>
> AKF拆分原则 业界对可扩展系统架构设计有一个朴素的概念，就是：通过加机器可以解决容量和可用性问题（如果一台不行就两台）用个段子描述就是：（世界上没有什么事是一顿烧烤解决不了的，如果有，那就两顿）
>
> 这一理念在“云计算”概念疯狂流行的今天。得到了广泛的认可。对于一个规模迅速增长的系统而言。**容量和性能问题**当然是首当其冲的。但是随着时间的向前，系统规模的增长，除了面对性能与容量的问题外，还需要面对功能与模块数量上增长带来的系统复杂性问题。以及业务变化带来的提供差异化服务问题。而许多系统在架构设计时并未充分考虑到这些问题，导致**系统的重构**成为常态。从而影响业务交付能力，还浪费人力财力。对此《可扩展的艺术》一书提出了一个更加系统的可扩展模型----AKF可扩展立方。

<img src="https://raw.githubusercontent.com/SeaSoonKeun/Picture/main/Blog_Pic/20210427134834.png" style="zoom:50%;" />



### 1. 单节点，单进程存在的问题：

- 单点故障
- 容量有限
- 数据承载压力有限



![](https://raw.githubusercontent.com/SeaSoonKeun/Picture/main/Blog_Pic/redis_akf.jpg)

- X轴：水平复制。全量镜像数据。

- Y轴：服务功能拆分。按照不同的业务进行分类，类似于oracle的分库。

- Z轴：按优先级进行数据分区。比如说某个模块数据过多，可以拆分为多个Redis客户端，全量数据分为多份，每个Redis中存一部分数据。

  

  ***此时虽然解决了单实例存在的三个问题，那么又会带来数据一致性问题。***



### 2. 解决数据一致性问题

- 同步阻塞方式

<img src="https://raw.githubusercontent.com/SeaSoonKeun/Picture/main/Blog_Pic/%E5%90%8C%E6%AD%A5%E9%98%BB%E5%A1%9E%E6%96%B9%E5%BC%8F.jpg" style="zoom:50%;" />

​	**强一致性导致服务阻塞，可用性差**	

- 异步

<img src="https://raw.githubusercontent.com/SeaSoonKeun/Picture/main/Blog_Pic/%E5%BC%82%E6%AD%A5.jpg" style="zoom:50%;" />

​	**异步处理，可用性强，但数据一致性差，容易丢失数据**

- 同步阻塞 + 异步

<img src="https://raw.githubusercontent.com/SeaSoonKeun/Picture/main/Blog_Pic/%E5%90%8C%E6%AD%A5%2B%E9%98%BB%E5%A1%9E.jpg" style="zoom:50%;" />

​	主节点与中间件之间同步阻塞，可用性相对来说较好（有可能会有脏读现象），可靠的中间件负责进行异步同步数据，**最终一致性**

## 2. CAP理论

补充知识：

> 主备模式：备用机一般不参与业务，只有在主挂掉之后，才会替代主去提供服务；
>
> 主从模式：主从同时提供服务，客户端可以访问主，也可以访问从。

redis一般采用的是主从复制的模式
